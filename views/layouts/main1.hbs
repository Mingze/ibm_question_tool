<!DOCTYPE HTML>
<!--
	Big Picture by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>IBM Watson - Question Input Tool</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<header id="header">
				<h1>OB Question Store</h1>
				<nav>
					<ul>
						<li><a href="#intro">Intro</a></li>
						<li><a href="#one">Règle</a></li>
						<li><a href="#main">Question</a></li>
						<li><a href="#contact">Contact</a></li>
					</ul>
				</nav>
			</header>
	
		<!-- Intro -->
			<section id="intro" class="main style1 dark fullscreen">
				<div class="content">
					<header>
						<h2 id="quote">Hey.</h2>
					</header>


					<p>Bienvenue à <strong>OB Question Store</strong>, ici nous allons collecter un maximum de questions afin d'entrainer <a href="www.ibm.com/fr/watson/">Watson</a> - le AI pour Orange Bank..</p>
					<footer>
						<a href="#one" class="button style2 down">More</a><br>
						<a href="#main" class="button_skip">Skip</a>
					</footer>
					
	</div>
	<img class="logo_ibm" src="images/WatsonW.png">
			</section>

		<!-- One -->
			<section id="one" class="main style1 dark fullscreen">

				<div class="content">
					<header>
						<h2 id="tuto">Entrez une question</h2>
					</header>
					<ul>
					<li>Saissisez une question concernant un domaine.</li>
					<li>Choisisez un domaine (Moyen de paiement, virement...).</li>
					<li>Indiquez-moi votre équipe pour facilider l'analyse statisqituqe!</li>
					</ul>
				
				<footer>
					<a href="#two" class="button style2 down">Next</a><br>
					<a href="#main" class="button_skip">Skip</a>
				</footer>

				</div>
				<img class="logo_ibm" src="images/WatsonW.png">
			</section>
<script type="text/javascript">
var quotes=new Array();
	quotes[0] = "Hey!";
	quotes[1] = "Hello!";
	quotes[2] = "Bonjour!";
	quotes[3] = "Hi!";
	quotes[4] = "Ciao!";
var tuto = new Array();
	tuto[0] = "Vous savez?";
	tuto[1] = "Tuto?";
	tuto[2] = "Règles!";
	tuto[3] = "Entrez vos questions!";
	tuto[4] = "Une autre question?";

var q = quotes.length;
var whichquote=Math.round(Math.random()*(q-1));
function showquote(){
	// console.log("ddsds", quotes[whichquote]);
	// var x = document.getElementById("quote").innerHTML;
	// console.log("old"+x);
	document.getElementById("quote").innerHTML=quotes[whichquote];
	document.getElementById("tuto").innerHTML=tuto[whichquote];
}
showquote();
</script>
<!-- 		
			<section id="two" class="main style2 left dark fullscreen">
				<div class="content box style2">
					<header>
						<h2>Who I Am</h2>
					</header>
					<p>Lorem ipsum dolor sit amet et sapien sed elementum egestas dolore condimentum.
					Fusce blandit ultrices sapien, in accumsan orci rhoncus eu. Sed sodales venenatis arcu,
					id varius justo euismod in. Curabitur egestas consectetur magna.</p>
				</div>
				<a href="#work" class="button style2 down">Next</a>
			</section> -->

		
			<section id="main" class="main style1 fullscreen">
				<div class="content">
					<header>
						<h2>My Work</h2>
						<p>Lorem ipsum dolor sit amet et sapien sed elementum egestas dolore condimentum.
						Fusce blandit ultrices sapien, in accumsan orci rhoncus eu. Sed sodales venenatis
						arcu, id varius justo euismod in. Curabitur egestas consectetur magna vitae.</p>
					</header>

					<!-- Gallery  -->
						<div class="gallery">
							<article class="from-left">
								<a href="images/fulls/01.jpg" class="image fit"><img src="images/thumbs/01.jpg" title="The Anonymous Red" alt="" /></a>
							</article>
							<article class="from-right">
								<a href="images/fulls/02.jpg" class="image fit"><img src="images/thumbs/02.jpg" title="Airchitecture II" alt="" /></a>
							</article>
							<article class="from-left">
								<a href="images/fulls/03.jpg" class="image fit"><img src="images/thumbs/03.jpg" title="Air Lounge" alt="" /></a>
							</article>
							<article class="from-right">
								<a href="images/fulls/04.jpg" class="image fit"><img src="images/thumbs/04.jpg" title="Carry on" alt="" /></a>
							</article>
							<article class="from-left">
								<a href="images/fulls/05.jpg" class="image fit"><img src="images/thumbs/05.jpg" title="The sparkling shell" alt="" /></a>
							</article>
							<article class="from-right">
								<a href="images/fulls/06.jpg" class="image fit"><img src="images/thumbs/06.jpg" title="Bent IX" alt="" /></a>
							</article>
						</div>

				</div>
			</section>

		<!-- Contact -->
			<section id="contact" class="main style3 secondary">
				<div class="content">
					<header>
						<h2>Say Hello.</h2>
						<p>Lorem ipsum dolor sit amet et sapien sed elementum egestas dolore condimentum.</p>
					</header>
					<div class="box">
						<form method="post" action="#">
							<div class="field half first"><input type="text" name="name" placeholder="Name" /></div>
							<div class="field half"><input type="email" name="email" placeholder="Email" /></div>
							<div class="field"><textarea name="message" placeholder="Message" rows="6"></textarea></div>
							<ul class="actions">
								<li><input type="submit" value="Send Message" /></li>
							</ul>
						</form>
					</div>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">

				<!-- Icons -->
					<ul class="actions">
						<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
						<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
						<li><a href="#" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
					</ul>

				<!-- Menu -->
					<ul class="menu">
						<li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
					</ul>

			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.poptrox.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
<script>
var profileFields = null;
var helpTextVisible = true;
var questionCleared = false;
var cookieExpiration = 5;

require([
	"dojo/domReady!"
],
function() {
	load();
});

function load() {
	require([
		"dojo/dom",
		"dojo/request",
		"dojo/cookie"
	],
	function(dom, request, cookie) {
		if (cookie("IBMWatsonQIT")) {
			console.log("IBMWatsonQIT cookie found with ID ", cookie("IBMWatsonQIT"));
			var id = cookie("IBMWatsonQIT");
			var url = "api/question/" + id;
			var options = {
				method: "GET",
				handleAs: "json",
			}
			var deferred = request(url, options);
			deferred.then(function(result) {
				//console.log(result);
				setConfiguration(result.profile_fields);
				setSubmittedQuestions(result.questions);
			}, function(error){
				console.log("API call " + url + " failed with error:" + error);
				setConfiguration(null);
			});
			
		} else {
			setConfiguration(null);
			setSubmittedQuestions(null);
		}
	});
}

function setConfiguration(profileValues) {
	require([
		"dojo/dom",
		"dojo/request",
	],
	function(dom, request) {
		var profileValuesMap = {};
		if (profileValues) {
			profileValues.forEach(function(field) {
				profileValuesMap[field.id] = field.value;
			});
		}
		
		var url = "api/configuration";
		var options = {
			method: "GET",
			handleAs: "json",
		}
		var deferred = request(url, options);
		deferred.then(function(result) {
			cookieExpiration = result.configuration.cookie_expiration;
			
			var helpText = dom.byId("helpText");
			helpText.innerHTML = result.configuration.help_text;
			
			var profileFieldsHTML = "";
			profileFields = result.configuration.profile_fields;
			result.configuration.profile_fields.forEach(function(field) {
				profileFieldsHTML += "<tr>";
				profileFieldsHTML += "<td class='profileFieldName'>";
				profileFieldsHTML += field.display;
				profileFieldsHTML += "</td>";
				switch(field.type) {
					case "select":
						profileFieldsHTML += "<td class='profileFieldValue'>";
						profileFieldsHTML += "<select id=" + field.id + " name=" + field.id + " class='profileSelectField'>";
						profileFieldsHTML += "<option value='s'></option>";
						field.values.forEach(function(value) {
							if (profileValuesMap[field.id] == value) {
								profileFieldsHTML += "<option value='" + value + "' selected>" + value + "</option>";
							} else {
								profileFieldsHTML += "<option value='" + value + "'>" + value + "</option>";
							}
						});
						profileFieldsHTML += "</select>"
						profileFieldsHTML += "</td>";
						break;
				}
				profileFieldsHTML += "</tr>";
			});
			
			var profileTable = dom.byId("profileTable");
			profileTable.innerHTML = profileFieldsHTML;
		}, function(error){
			console.log("API call " + url + " failed with error:" + error);
		});
	});
}

function setSubmittedQuestions(questions) {
	require([
		"dojo/dom"
	],
	function(dom) {
		var submittedQuestionsDiv = dom.byId("submittedQuestions");
		if (questions) {
			if (questions.length > 0) {
				submittedQuestionsDiv.innerHTML = "";
				questions.forEach(function(question) {
					submittedQuestionsDiv.innerHTML += "<div class='submittedQuestion'>" + question + "</div>";
				});
			} else {
				submittedQuestionsDiv.innerHTML = "<div class='submittedQuestion'>No questions submitted yet, please submit one!</div>";
			}
		} else {
			submittedQuestionsDiv.innerHTML = "<div class='submittedQuestion'>No questions submitted yet, please submit one!</div>";
		}
	});
}

function clearQuestion() {

	require([
		"dojo/dom",
		"dojo/dom-class",
		"dojo/dom-style"
	],
	function(dom, domClass, domStyle) {
		var question = dom.byId("question");
		question.value ="";
		if (!questionCleared) {
			question.value = "";
			var helpTextContainer = dom.byId("helpTextContainer");
			domClass.add(helpTextContainer, "hidden");
			var btnHelp = dom.byId("btnHelp");
			domClass.remove(btnHelp, "btnHelpOn");
			domClass.add(btnHelp, "btnHelp");
			helpTextVisible = false;
			
			question.value = "";
			questionCleared = true;
		}
	});
}

function submit() {
	require([
		"dojo/dom",
		"dojo/dom-form",
		"dojo/dom-class",
		"dojo/request",
		"dojo/cookie"
	],
	function(dom, domForm, domClass, request, cookie) {
		var question = domForm.fieldToObject("question");
		//console.log("question", question);
		if (question == "" || question == "Enter your question here") {
			var questionErrorContainer = dom.byId("questionErrorContainer");
			var questionError = dom.byId("questionError");
			domClass.remove(questionErrorContainer, "hidden");
			questionError.innerHTML = "Please enter a question";
			window.setTimeout(function() {clearErrors();}, 3000);
		} else {
			showProgress();
			var id = "";
			if (cookie("IBMWatsonQIT")) {
				console.log("IBMWatsonQIT cookie found with ID ", cookie("IBMWatsonQIT"));
				id = cookie("IBMWatsonQIT");
			}
			var fields = [];
			profileFields.forEach(function(field) {
				var fieldValue = domForm.fieldToObject(field.id);
				fields.push({id: field.id, value: fieldValue});
			});
			
			var url = "api/save";
			var options = {
				method: "POST",
				handleAs: "json",
				data: {
					id: id,
					question: question,
					profile_fields: JSON.stringify(fields)
				}
			}
			
			var deferred = request(url, options);
			deferred.then(function(result) {
				//console.log(result);
				if (cookie("IBMWatsonQIT") != result.id) {
					console.log("setting IBMWatsonQIT cookie with ID ", result.id);
					cookie("IBMWatsonQIT", result.id, { expires: cookieExpiration });
				}
				var statusMsgContainerDiv = dom.byId("statusMsgContainer");
				var statusMsgDiv = dom.byId("statusMsg");
				statusMsgDiv.innerHTML = "Votre question a été soumise!";
				domClass.add(statusMsgContainerDiv, "statusMsgSuccess");
				domClass.remove(statusMsgContainerDiv, "hidden");
				window.setTimeout(function() {clearStatusMsg();}, 5000);
				hideProgress();
				load();
			}, function(error){
				console.log("API call " + url + " failed with error:" + error);
				var statusMsgContainerDiv = dom.byId("statusMsgContainer");
				var statusMsgDiv = dom.byId("statusMsg");
				statusMsgDiv.innerHTML = "Une erreur s'est produite. Merci de contacter l'administrateur.";
				domClass.add(statusMsgContainerDiv, "statusMsgError");
				domClass.remove(statusMsgContainerDiv, "hidden");
				window.setTimeout(function() {clearStatusMsg();}, 5000);
				hideProgress();
			});
		}
        $('#question').html('test');
	});
}

function showProgress() {
	require([
		"dojo/dom",
		"dojo/dom-class",
		"dojo/dom-style"
	],
	function(dom, domClass, domStyle) {
		var progress = dom.byId("refreshProgress");
		var btnSubmit = dom.byId("btnSubmit");
		domClass.remove(progress, "hidden");
		domStyle.set(btnSubmit, "opacity", "0.5");
		btnSubmit.removeAttribute("onclick");
		domClass.remove(btnSubmit, "btnSubmit");
		domClass.add(btnSubmit, "btnSubmitDisabled");
	});
}

function hideProgress() {
	require([
		"dojo/dom",
		"dojo/dom-class",
		"dojo/dom-style"
	],
	function(dom, domClass, domStyle) {
		var progress = dom.byId("refreshProgress");
		var btnSubmit = dom.byId("btnSubmit");
		domClass.add(progress, "hidden");
		domStyle.set(btnSubmit, "opacity", "1.0");
		btnSubmit.setAttribute("onclick", "submit()");
		domClass.remove(btnSubmit, "btnSubmitDisabled");
		domClass.add(btnSubmit, "btnSubmit");
	});
}

function clearErrors() {
	require([
		"dojo/dom",
		"dojo/dom-class",
	],
	function(dom, domClass) {
		var questionErrorContainer = dom.byId("questionErrorContainer");
		var questionError = dom.byId("questionError");
		questionError.innerHTML = "";
		domClass.add(questionErrorContainer, "hidden");
	});
}

function clearStatusMsg() {
	require([
		"dojo/dom",
		"dojo/dom-class",
	],
	function(dom, domClass) {
		var statusMsgContainerDiv = dom.byId("statusMsgContainer");
		var statusMsgDiv = dom.byId("statusMsg");
		statusMsgDiv.innerHTML = "";
		domClass.add(statusMsgContainerDiv, "hidden");
		domClass.remove(statusMsgContainerDiv, "statusMsgSuccess");
		domClass.remove(statusMsgContainerDiv, "statusMsgError");
	});
}

function showHelp() {
	require([
		"dojo/dom",
		"dojo/dom-class",
	],
	function(dom, domClass) {
		var helpTextContainer = dom.byId("helpTextContainer");
		var btnHelp = dom.byId("btnHelp");
		if (helpTextVisible) {
			domClass.add(helpTextContainer, "hidden");
			domClass.remove(btnHelp, "btnHelpOn");
			domClass.add(btnHelp, "btnHelp");
			helpTextVisible = false;
		} else {
			domClass.remove(helpTextContainer, "hidden");
			domClass.remove(btnHelp, "btnHelp");
			domClass.add(btnHelp, "btnHelpOn");
			helpTextVisible = true;
		}
	});
}
</script>
	</body>
</html>